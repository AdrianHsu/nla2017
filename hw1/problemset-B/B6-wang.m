C = [2 -1  0  0  0  0  0; ...
    -1  2 -1  0  0  0  0; ...
     0 -1  2 -1  0  0  0; ...
     0  0 -1  2 -1  0  0; ...
     0  0  0 -1  2 -1  0; ...
     0  0  0  0 -1  2 -1; ...
     0  0  0  0  0 -1  2];

% original matrix A
i = [1 1 2 2 2 3 3 3 4 4 4 5 5 5 6 6 6 7 7];
j = [1 2 1 2 3 2 3 4 3 4 5 4 5 6 5 6 7 6 7];
v = [2 -1 -1 2 -1 -1 2 -1 -1 2 -1 -1 2 -1 -1 2 -1 -1 2];
A = sparse(i,j,v);
disp(A);

% find each column in S
% where x3 = x4 = x5
x1 = lsqlin([2 -1;-1 2;0 -1],[1,0,0],[],[]);
x2 = lsqlin([2 -1 0;-1 2 -1;0 -1 2;0 0 -1], [0,1,0,0],[],[]);
x3 = lsqlin([-1 0 0;2 -1 0;-1 2 -1;0 -1 2;0 0 -1], [0 0 1 0 0],[],[]);
x6 = lsqlin([-1 0 0;2 -1 0;-1 2 -1;0 -1 2],[0 0 1 0],[],[]);
x7 = lsqlin([-1 0;2 -1;-1 2],[0,0,1],[],[]);

S = zeros(7);
S(1:2,1) = x1;
S(1:3,2) = x2;
S(2:4,3) = x3;
S(3:5,4) = x3;
S(4:6,5) = x3;
S(5:7,6) = x6;
S(6:7,7) = x7;
disp(S);

norm = (norm(eye(7) - C*S, 'fro'))^2;